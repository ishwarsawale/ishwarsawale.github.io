---
title: Why an image of shopping bags on book covers still mean "women's fiction"
header:
  teaser: /images/covers/head.jpg
categories:
  - data analysis
tags:
  - update
---

**rubric text for predicting genres from book cover types**

![alt text](/images/covers/head.jpg)

# The art of giving a hunch

Book covers is an art. They invite us to read, promise us the world and can evenly disappoint. In a recent data project for the Economist Newspaper, I conducted an investigation in the world of book publishing and book jackets. Here we will try not to only understand what is in the data, but to write predictive models to see how well machine learning can help us to make sense of the design of a book cover.

The data is a consolidation of books with a significance in their - lets call it "out of the ordinary" - book jacket design. Goodreads' API permitted to gather data on the genre, author's data, publishers, and ratings and reviews. The piece that resulted from the research can be found [here](economist-article.com).

## Finding a signal in the data

The first thing that we want is to find a signal. The aim is to understand the predictive power of the type of book covers we have in the data, and to comprehend the impact on genres for books that show women with hats on the jacket versus an image of macarons. ![alt text](/images/covers/plots/signal1.jpg)

A different piece of work did the researchers .. and ... conduct on book covers. I believe their effort on data collection was more substantial. Their results allowed understanding what kinds of genre was more difficult or harder to predict. Their data source on book genres came from Amazon. The key difference for my piece of work is that the data comes from user generated lists, collection of book covers with a significant feature in their cover, and not just a random sample.

![alt text](/images/covers/plots/dist_gender.png)

First, let us understand how many female and male authors we have in the data.

```{r}
gender_classification <- types_all %>%
  mutate(gender = (if_else(as.character(gender) == "" | as.character(gender) == " ", "unknown", as.character(gender))))

prop.table(table(gender_classification$gender))
```

Output:<br>
female male unknown 0.5701554 0.2865631 0.1432815

Many female authors, as expected. 80% of demand for book in the literatire publishing is driven by women. While it doesn't esssentially explain why more peculiar book covers are designed for female books (the lists on books with an outstanding/singificant book cover is user generated by Goodreads users), it might offer a hunch that a large chunk of female authors get a book cover served that fit into the following categories (bad enought):

```{r}
library(forcats)

dis_type <- gender_classification %>%
  count(book_cover_type, gender) %>%
        mutate(type = str_replace_all(book_cover_type, "_all", "_")) %>%
        mutate(type = tolower(str_replace_all(type, "_", " "))) %>%
        mutate(gender = if_else(is.na(as.character(gender)), "unknown", as.character(gender)))

dis_type <- within(dis_type,
                   book_cover_type <- factor(book_cover_type,
                                      levels=names(sort(table(book_cover_type),
                                                        decreasing=TRUE))))

library(scales)

View(dis_type)
ggplot(dis_type, aes(fct_reorder(type, n), n, fill = gender)) +
  scale_fill_manual(values=c("red", "navy blue", "grey", "grey")) +
  geom_bar(show.legend = T, position = "fill",stat = "identity") +
  theme_bh + coord_flip() + ggtitle("Gender distribution of authors with peculiar cover")+
  scale_y_continuous(labels = percent_format()) +
  ggsave("/Users/BH/benheubl.github.io/images/covers/plots/dist_gender.png", height = 20, width = 15, units = "cm") + xlab("")
```

We can clearly see that certain covers are more prone to be written by female autors than their male counterparts when it comes to these "extremes" of book cover design. The chart also provides with a hunch of a signal, as of gender as a depented variable for type of a peculiar cover.

It reveals a moraly wrong idea of the book indsutry. So much to the point that the publishing industry isn't sexist anymore. It seems they are very much so, still (if you are a writer, next time please do us all a favour to boicott, if your publishing house comes up with a this great concept of "a stylish shopping bag hardcover design" for your next book jacket).

By the same token, we need to keep in mind all along that we draw data from samples, user generated lists, not from pupularions (e.g all books with women and hats, only a large part Goodreads users found on their own).

There are other factors that could offer a signal on the gender.

```{r}
# library(caret)

# plotting distributions for male and female authored books and their number of pages

View(gender_classification)
```

## Which book cover types are most telling:

```{r}

nrow(gender_classification_pages)
gender_classification_pages <- gender_classification %>%
  mutate(num_pages = as.numeric(num_pages)) %>%
  filter(!is.na(num_pages)) %>%
  filter(gender != "unknown")  %>%
    mutate(text_reviews_count = as.numeric(text_reviews_count)) %>%  
    filter(!is.na(text_reviews_count)) %>%
    mutate(text_reviews_count = as.factor(Genre_class_all))



# %>%
# mutate(gender = as.factor(if_else(gender == "female", 1, 0)))

contrasts(gender_classification_pages$gender)

## set the seed to make your partition reproductible
library(caret)
set.seed(123)
intrain<-createDataPartition(y=gender_classification_pages$gender,p=0.7,list=FALSE)
training_glm_1<-gender_classification_pages[intrain,]
testing_glm_1<-gender_classification_pages[-intrain,]

# model_glm <- glm(as.factor(gender)~ num_pages + book_cover_type,
#                    family=binomial(link='logit'),data=training_glm_1)
# summary(model_glm)


# caret with cross validation:
train_control = trainControl(method="cv", number=5,
                             # summaryFunction=twoClassSummary,
                             # classProbs=T,
                             savePredictions = T)
# formula
formula = as.factor(gender) ~ num_pages + book_cover_type + Genre_class_all

modelLog = train(formula, data=training_glm_1, method="glm",
                 preProc=c("center", "scale"),
                 family=binomial, trControl=train_control)
PredTrain = predict(modelLog, newdata=training_glm_1, type="raw")
# View(as.data.frame(PredTrain))
# View(modelLog$pred$pred)

#seen training data:
confusionMatrix(data = PredTrain, training_glm_1$gender)
summary(modelLog)$coef

#unseen test data:
plsClasses <- predict(modelLog, newdata = testing_glm_1)
confusionMatrix(data = plsClasses, testing_glm_1$gender)


library(pROC)
#Draw the ROC curve
gbm.probs <- predict(modelLog,newdata = testing_glm_1,type="prob")
str(testing_glm_1$gender)

testing_glm_1 <- testing_glm_1 %>% mutate(gender = as.numeric(if_else(gender == "female", 1, 0)))

glm.roc <- roc(predictor=gbm.probs$female,
               response=testing_glm_1$gender)
# ,
#                levels=rev(levels(testing_glm_1$gender)))
glm.roc$auc
#Area under the curve: 0.8731
plot(glm.roc,main="GLM ROC")
```

```{r}

# preduct and meausre accuracy:
fitted.results_covers <- predict(model_glm,newdata=testing_glm_1,type='response')
fitted.results_covers <- ifelse(fitted.results > 0.5,"male","female")
# View(as.data.frame(testing_glm_1$gender))

misClasificError_covers <- mean(fitted.results_covers != testing_glm_1$gender)
print(paste('Accuracy',1-misClasificError_covers))
```

# Wrapping up
